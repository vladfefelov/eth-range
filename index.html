<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Диапазон Ethereum</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #range { margin-top: 20px; font-size: 18px; }
    </style>
</head>
<body>

    <h1>Прогнозируемый диапазон Ethereum</h1>
    <button onclick="getPriceRange()">Обновить диапазон</button>
    <p id="range">Нажмите кнопку, чтобы узнать диапазон.</p>

    <script>
        async function getPriceRange() {
            try {
                // Получаем данные за последние 20 дней (для расчёта Bollinger Bands)
                const response = await fetch("https://api.binance.com/api/v3/klines?symbol=ETHUSDT&interval=1d&limit=20");
                const data = await response.json();

                let closingPrices = data.map(item => parseFloat(item[4])); // Цены закрытия
                let currentPrice = closingPrices[closingPrices.length - 1]; // Последняя цена

                // Вычисляем SMA (Simple Moving Average)
                let sma = closingPrices.reduce((sum, price) => sum + price, 0) / closingPrices.length;

                // Вычисляем стандартное отклонение
                let variance = closingPrices.reduce((sum, price) => sum + Math.pow(price - sma, 2), 0) / closingPrices.length;
                let stdDev = Math.sqrt(variance);

                // Bollinger Bands
                let upperBand = (sma + 2 * stdDev).toFixed(2);
                let lowerBand = (sma - 2 * stdDev).toFixed(2);

                // Вычисляем ATR (Average True Range)
                let atrValues = [];
                for (let i = 1; i < closingPrices.length; i++) {
                    let tr = Math.abs(closingPrices[i] - closingPrices[i - 1]);
                    atrValues.push(tr);
                }
                let atr = atrValues.reduce((sum, value) => sum + value, 0) / atrValues.length;

                // Диапазон на основе ATR
                let atrLower = (currentPrice - atr).toFixed(2);
                let atrUpper = (currentPrice + atr).toFixed(2);

                // Финальный диапазон = пересечение Bollinger Bands и ATR
                let finalLower = Math.max(lowerBand, atrLower);
                let finalUpper = Math.min(upperBand, atrUpper);

                document.getElementById("range").innerText = `Ожидаемый диапазон: ${finalLower} - ${finalUpper} USDT`;

            } catch (error) {
                document.getElementById("range").innerText = "Ошибка при получении данных.";
            }
        }
    </script>

</body>
</html>